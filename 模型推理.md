# 模型推理

## 模型支持列表

<table>
    <thead>
        <tr>
            <th>模型类型</th>
            <th>任务类型</th>
            <th>模型列表</th>
            <th>支持尺寸</th>
            <th>CPU适配</th>
            <th>NPU适配</th>
            <th>模型详情</th>
            <th>SDK连接</th>
        </tr>
    </thead>
    <tbody>    
        <tr>
            <td>det_pico</td>
            <td>目标检测</td>
            <td>picodet</td>
            <td>192x192</td>
            <td>是</td>
            <td>否</td>
            <td><a href="https://github.com/PaddlePaddle/PaddleDetection/tree/release/2.4/configs/picodet">模型详情</a></td>
            <td><a href="https://bj.bcebos.com/ppdeploy/ppdeploy1.0/PPDeploy1.0_picodet_PaddleDetection2.4_paddle2.2.2_Ver1.0.0.zip">下载链接</a></td>
        </tr>
        <tr>
            <td>clas_resnet</td>
            <td>图片分类</td>
            <td>ResNet18<br>ResNet34<br>ResNet50</td>
            <td>224x224</td>
            <td>是</td>
            <td>是</td>
            <td><a href="https://github.com/PaddlePaddle/PaddleClas/blob/release/2.5/docs/zh_CN/models/ImageNet1k/model_list.md#resnet-%E7%B3%BB%E5%88%97-1">模型详情</a></td>
            <td><a href="https://bj.bcebos.com/ppdeploy/ppdeploy1.0/PPDeploy1.0_resnet_PaddleClas2.5_Paddle2.2.2_Ver1.0.0.zip">下载链接</a></td>
        </tr>
        <tr>
            <td>det_yolov3</td>
            <td>目标检测</td>
            <td>YOLOv3-Mobilenet-V1<br>YOLOv3-DarkNet53<br>YOLOv3-ResNet34</td>
            <td>320x320<br>416x416<br>608x608</td>
            <td>是</td>
            <td>是</td>
            <td><a href="https://github.com/PaddlePaddle/PaddleDetection/tree/release/2.6/configs/yolov3#yolov3">模型详情</a></td>
            <td><a href="https://bj.bcebos.com/ppdeploy/ppdeploy1.0/PPDeploy1.0_yolov3_PaddleDetection2.6_Paddle2.2.2_Ver1.0.0.zip">下载链接</a></td>
        </tr>
        <tr>
            <td>kpt_hrnet</td>
            <td>人体关键点检测</td>
            <td>HRNet-w32</td>
            <td>256x192<br>384x288</td>
            <td>是</td>
            <td>是</td>
            <td><a href="https://github.com/PaddlePaddle/PaddleDetection/tree/release/2.6/configs/keypoint#%E6%A8%A1%E5%9E%8B%E5%BA%93">模型详情</a></td>
            <td><a href="https://bj.bcebos.com/ppdeploy/ppdeploy1.0/PPDeploy1.0_PoseDeploy_PaddleDetection2.6_Paddle2.2.2_Ver1.0.0.zip">下载链接</a></td>
        </tr>
    </tbody>    
</table>

## AI项目流程概述

AI项目流程大致可以划分为**确定应用场景和目标**、
**数据收集和预处理**、
**选择或设计AI模型**、
**模型训练**、
**模型评估**、
**模型导出/编译**、
**模型部署**多个步骤。<br>
其中确定应用场景和目标、数据收集和预处理、选择或设计AI模型、模型训练、模型评估前几个环节可参考百度相关开源项目，本文档重点展开和EdgeBoard DK-1A更加密切的模型导出/编译、模型部署环节。

### 确定应用场景和目标

确定应用场景和目标，这是为了明确我们要解决的问题以及模型的预期表现。

### 数据收集和预处理

数据收集和预处理，我们需要选择与场景相关的数据，并进行清洗、标注等操作，以便模型可以更好地理解和学习。

### 选择或设计AI模型

选择或设计AI模型，这一步需要基于问题的类型（例如分类、回归或聚类）和数据的特性来选择合适的模型架构。可根据项目情况选择前序 [模型支持列表](#模型支持列表) 中的模型或联系百度商务定制模型。

### 模型训练

模型训练，这是通过将数据输入模型并调整模型参数使得模型可以更好地拟合数据的过程。这一步通常需要大量的计算资源。
这一步中，我们默认使用百度提供的AI Studio平台，也可以选择自行搭建训练环境。

### 模型评估

模型评估，我们通过一些指标（如精度、召回率等）来评价模型的表现，以确定模型是否满足我们的需求。

### 模型导出/编译

模型导出/编译，将训练好的模型导出为适合部署在EdgeBoard DK-1A板卡上的模型格式。

### 模型部署

模型部署，将模型文件拷贝到EdgeBoard DK-1A板卡中，并配置好模型运行环境。

模型sdk部署套件下载后解压，置于/home/edgeboard目录下。

验证板卡推理环境
在python环境下验证板卡是否正确安装:
``` python
import ppnc
```
运行不报错即说明板卡已正确安装。

## 例：det_picodet

## 例：det_resnet

### 模型获得

基于AIStudio中的范例项目[基于ResNet进行物品分类](https://aistudio.baidu.com/projectdetail/7153172?contributionType=1&sUid=1318783&shared=1&ts=1701053232435)进行模型的训练、评估和导出。

联系百度技术支持进行模型高性能转化。

下载已经转化好的模型文件（此处使用范例项目已转化好的模型）。

```shell
cd /home/edgeboard/Downloads/
sudo wget https://bj.bcebos.com/ppdeploy/ppdeploy1.1/models/resnet-model.zip
```

### 模型部署

解压文件。

```shell
unzip resnet-model.zip
```

#### Python部署

Step1：将解压出来的model文件夹置于/home/edgeboard/目录下。

```shell
mv model /home/edgeboard
```

Step2：配置config.json文件。

```json
    {
        "mode": "professional",     //固定字段无需修改
        "model_dir": "./model",     //模型文件路径 
        "model_file": "model"       //固定为model，无需修改
    }
```

Sttep3：运行推理代码。

```python
import ppnc
# 初始化模型
model = ppnc.init_model(config='./config.json')
    # 加载图片
    img = cv2.imread('test.jpg')
    # 推理
    result = model.predict(img)
    # 打印结果
    print(result)
    # 关闭模型
    model.close()
    # 释放资源
    ppnc.release()
    # 结束
    sys.exit()
```

#### C++部署

## 例3：det_yolov3

## 例4：kpt_hrnet
